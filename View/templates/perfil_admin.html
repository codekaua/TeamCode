<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Meu Perfil - Usuário</title>
    <link
      rel="stylesheet"
      href="{{url_for('static', path='Pasta_css/style_perfil.css') }}"
    />
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <h1>Meu perfil Administrador</h1>
      </div>

      <!-- Profile Section -->
      <div class="profile-section">
        <div class="profile-header">
          <div class="avatar">
            <div class="avatar-placeholder">
              <svg
                class="avatar-icon"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
                />
              </svg>
            </div>
          </div>
          <div class="profile-info">
            <h2 id="profileName">{{usuario.nome}}</h2>
            <p class="email" id="profileEmail">{{usuario.email}}</p>
          </div>
        </div>

        <!-- 2FA Section -->
        <div class="two-factor-auth">
          <div class="two-factor-content">
            <div class="two-factor-status">
              <div
                class="toggle-switch"
                id="twoFactorToggle"
                onclick="toggle2FA()"
              >
                <div class="toggle-slider"></div>
              </div>
              <span class="two-factor-label"
                >Autenticação em 2 fatores:
                <span id="twoFactorStatus">Desativada</span>.</span
              >
              <a
                href="#"
                class="activate-link"
                id="activateLink"
                onclick="toggle2FA(); return false;"
                >Ativar</a
              >
            </div>
            <p class="two-factor-description">
              Habilitando a Autenticação em dois fatores será sempre solicitado
              um código de acesso enviado via sms ao celular cadastrado.
            </p>
          </div>
        </div>
      </div>

      <!-- Form Section -->
      <div class="form-section">
        <div class="form-header">
          <h2>Meus dados</h2>
        </div>

        <div class="success-message" id="successMessage">
          ✓ Dados salvos com sucesso!
        </div>

        <form id="profileForm" onsubmit="saveProfile(event)">
          <div class="form-group">
            <label for="name">Nome<span class="required">*</span></label>
            <p class="ps">{{usuario.nome}}</p>
          </div>

          <div class="form-group">
            <label for="email">E-mail<span class="required">*</span></label>
            <p class="ps">{{usuario.email}}</p>
          </div>

          <div class="form-group">
            <label for="phone">Telefone celular</label>
            <p class="ps">(00) 00000-0000</p>
          </div>

          <div class="form-actions">
            <a href="/admin" class="btn btn-secondary">Página do Administrador</a>
          </div>
        </form>
      </div>
    </div>

    <script>
      // 2FA Toggle functionality
      let twoFactorEnabled = false;

      function toggle2FA() {
        twoFactorEnabled = !twoFactorEnabled;
        const toggle = document.getElementById("twoFactorToggle");
        const status = document.getElementById("twoFactorStatus");
        const link = document.getElementById("activateLink");

        if (twoFactorEnabled) {
          toggle.classList.add("active");
          status.textContent = "Ativada";
          link.textContent = "Desativar";
          link.style.color = "#d32f2f";
        } else {
          toggle.classList.remove("active");
          status.textContent = "Desativada";
          link.textContent = "Ativar";
          link.style.color = "#1976d2";
        }
      }

      // Form submission
      function saveProfile(event) {
        event.preventDefault();

        // Add loading state to button
        const saveBtn = document.getElementById("saveBtn");
        saveBtn.classList.add("loading");
        saveBtn.textContent = "";

        const formData = {
          name: document.getElementById("name").value,
          email: document.getElementById("email").value,
          phone: document.getElementById("phone").value,
          password: document.getElementById("password").value,
          notifications: document.getElementById("notifications").checked,
          twoFactorAuth: twoFactorEnabled,
        };

        console.log("Saving profile data:", formData);

        // Simulate API call delay
        setTimeout(() => {
          // Update profile name and email in header
          document.getElementById("profileName").textContent = formData.name;
          document.getElementById("profileEmail").textContent = formData.email;

          // Show success message
          const successMessage = document.getElementById("successMessage");
          successMessage.classList.add("show");

          // Clear password field
          document.getElementById("password").value = "";

          // Remove loading state
          saveBtn.classList.remove("loading");
          saveBtn.textContent = "SALVAR";

          // Hide success message after 3 seconds
          setTimeout(() => {
            successMessage.classList.remove("show");
          }, 3000);
        }, 1000);
      }

      // Cancel form
      function cancelForm() {
        if (confirm("Deseja realmente cancelar as alterações?")) {
          document.getElementById("profileForm").reset();
          document.getElementById("name").value = "Suporte Granatum";
          document.getElementById("email").value = "suporte@granatum.com.br";
          document.getElementById("notifications").checked = true;
        }
      }

      // Phone mask
      document.getElementById("phone").addEventListener("input", function (e) {
        let value = e.target.value.replace(/\D/g, "");
        if (value.length > 11) value = value.slice(0, 11);

        if (value.length > 6) {
          value = value.replace(/^(\d{2})(\d{5})(\d{0,4}).*/, "($1) $2-$3");
        } else if (value.length > 2) {
          value = value.replace(/^(\d{2})(\d{0,5})/, "($1) $2");
        } else if (value.length > 0) {
          value = value.replace(/^(\d*)/, "($1");
        }

        e.target.value = value;
      });
    </script>
  </body>
</html>
